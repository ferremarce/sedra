<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/includes/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h1>Documentos Pendientes</h1>
    </ui:define>

    <ui:define name="content">
        <h:form id="formMain">
            <p:toolbar>
                <p:toolbarGroup>
                    <p:inputText styleClass="espaciadoToolbar" size="50" id="criterio" value="#{TramitacionController.criterioBusqueda}" placeholder="Asunto, Nro. Entrada" />
                    <p:commandButton styleClass="espaciadoToolbar" id="cmdBuscar" icon="fa fa-search" ajax="true" action="#{TramitacionController.buscarAllPendiente()}" update="@form, panelMensajeEstado"/>
                </p:toolbarGroup>
            </p:toolbar>
            <p:watermark for="criterio" value="Asunto, Nro. Entrada"/>
            <p:tabView id="tabPendiente">
                <p:tab>
                    <f:facet name="title">
                        <h:outputText value="Pendiente de Confirmación [#{TramitacionController.listaTramitacionPendiente.size()}]"/>
                        <i class="fa fa-bell"/>
                    </f:facet>
                    <p:dataTable rowIndexVar="index" id="dataTablePendiente" var="item" value="#{TramitacionController.listaTramitacionPendiente}" reflow="true" emptyMessage="#{bundle.SinRegistrosMensaje}"
                                 rows="10"
                                 paginator="true"
                                 filterEvent="enter"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="#{bundle.Paginacion}"
                                 >
                        <f:facet name="header">
                            Tabla de Datos
                        </f:facet>  
                        <p:column headerText="F. Deriv." width="80" sortBy="#{item.fechaDerivacion}" >
                            <h:outputText value="#{item.fechaDerivacion}">
                                <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Documento" sortBy="#{item.idDocumento.numeroExpediente}">  
                            <h:outputText title="#{item.idDocumento}" styleClass="fontBold Blue" value="#{item.idDocumento.numeroExpediente}">
                                <f:convertNumber pattern="0000000000000"/>
                            </h:outputText>
                            <blockquote>
                                <h:outputText styleClass="Brown fontBold" value="#{item.idDocumento.asunto}"/>
                            </blockquote>
                        </p:column>
                        <p:column headerText="Remitido a" width="150" sortBy="#{item.remitidoA}">  
                            <h:outputText value="#{item.remitidoA}"/><br/>
                            <h:outputText styleClass="fontBold" value="[#{item.idRol.descripcionRol}]"/>
                        </p:column>
                        <p:column headerText="Observación" width="200">  
                            <h:outputText value="#{item.observacion}"/>
                        </p:column>
                        <p:column headerText="Adjunto" width="100">  
                            <p:commandButton rendered="#{item.nombreArchivo!=null}" title="Descargar" icon="fa fa-download" ajax="false">
                                <p:fileDownload value="#{DownloadFile.downloadDocumentoTramite(item.idTramitacion)}" />  
                            </p:commandButton>
                            <h:outputText value="#{item.nombreArchivo!=null ? item.nombreArchivo:'Sin archivo'}"/>
                        </p:column>   
                        <p:column width="120">
                            <f:facet name="header">
                                <h:outputText value="Acción"/>
                            </f:facet>
                            <p:menuButton value="Opciones">
                                <p:menuitem ajax="false" title="#{bundle.RechazarBoton}" value="#{bundle.RechazarBoton}" icon="fa fa-remove" action="#{TramitacionController.rechazaSetup(item.idTramitacion)}"/>
                                <p:menuitem title="#{bundle.ConfirmarBoton}" value="#{bundle.ConfirmarBoton}" icon="fa fa-check-square" action="#{TramitacionController.confirmaTramite(item.idTramitacion)}" update="@form, panelMensajeEstado">
                                    <p:confirm escape="false" header="Confirmación" message="Está a punto de confirmar el Documento ##{item.idDocumento.toString()}. &lt;br/&gt;¿Estás seguro?" icon="fa fa-exclamation-triangle" />
                                </p:menuitem>
                            </p:menuButton>
                        </p:column>
                    </p:dataTable>
                </p:tab>
                <p:tab>
                    <f:facet name="title">
                        <h:outputText value="Pendiente de Tramitación [#{TramitacionController.listaTramitacionConfirmado.size()}]"/>
                        <i class="fa fa-bell"/>
                    </f:facet>
                    <p:dataTable rowIndexVar="index2" id="dataTablePendienteConfirmado" var="item2" value="#{TramitacionController.listaTramitacionConfirmado}" reflow="true" emptyMessage="#{bundle.SinRegistrosMensaje}"
                                 rows="10"
                                 paginator="true"
                                 filterEvent="enter"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="#{bundle.Paginacion}"
                                 selection="#{TramitacionController.selectedTramitacion}"
                                 rowKey="#{item2}"
                                 >
                        <f:facet name="header">
                            Tabla de Datos
                        </f:facet>
                        <p:column selectionMode="multiple" width="20"/>  
                        <p:column headerText="F. Deriv." width="80" sortBy="#{item2.fechaDerivacion}" >
                            <h:outputText value="#{item2.fechaDerivacion}">
                                <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Documento" sortBy="#{item2.idDocumento.numeroExpediente}">  
                            <h:outputText value="Nro. Expediente: #{item2.idDocumento.numeroExpediente}">
                                <f:convertNumber pattern="0000000000000"/>
                            </h:outputText>
                            <blockquote>
                                <h:outputText styleClass="Brown fontBold" value="#{item2.idDocumento.asunto}"/>
                            </blockquote>
                        </p:column>
                        <p:column headerText="Remitido a" width="150" sortBy="#{item2.remitidoA}">  
                            <h:outputText value="#{item2.remitidoA}"/><br/>
                            <h:outputText styleClass="fontBold" value="[#{item2.idRol.descripcionRol}]"/>
                        </p:column>
                        <p:column headerText="Observación" width="200">  
                            <h:outputText value="#{item2.observacion}"/>
                        </p:column>
                        <p:column headerText="Adjunto" style="width: 10%">  
                            <p:commandButton rendered="#{item2.nombreArchivo!=null}" title="Descargar" icon="fa fa-download" ajax="false">
                                <p:fileDownload value="#{DownloadFile.downloadDocumentoTramite(item2.idTramitacion)}" />  
                            </p:commandButton>
                            <h:outputText value="#{item2.nombreArchivo!=null ? item2.nombreArchivo:'Sin archivo'}"/>
                        </p:column>   
                    </p:dataTable>
                    <p:panelGrid columns="1" styleClass="ui-panelgrid-blank" >
                        <p:commandButton ajax="false" title="#{bundle.DerivarBoton}" value="#{bundle.DerivarBoton}" icon="fa fa-random" action="#{TramitacionController.derivaMultipleSetup()}"/>                        
                    </p:panelGrid>

                </p:tab>
            </p:tabView>
        </h:form>
    </ui:define>

</ui:composition>
