<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="title">
        <h1>Listado de Documentos en Dependencias</h1>
    </ui:define>

    <ui:define name="content">
        <h:form id="formMain">
            <p:panel header="Parámetros de Búsqueda">
                <h:panelGrid columns="2" >
                    <h:outputLabel for="fechaDesde" styleClass="itemResaltado1"  value="(*) Desde:"/>
                    <h:panelGrid columns="2">
                        <p:calendar navigator="true"  size="10" id="fechaDesde" value="#{ReporteController.tmpFechaDesde}" pattern="dd/MM/yyyy" title="Fecha Desde" required="true" requiredMessage="#{bundle.Requerido}"/>
                        <p:message for="fechaDesde"/>
                    </h:panelGrid>
                    <h:outputLabel for="fechaHasta" styleClass="itemResaltado1"  value="(*) Hasta:"/>
                    <h:panelGrid columns="2">
                        <p:calendar navigator="true"  size="10" id="fechaHasta" value="#{ReporteController.tmpFechaHasta}" pattern="dd/MM/yyyy" title="Fecha Hasta" required="true" requiredMessage="#{bundle.Requerido}"/>
                        <p:message for="fechaHasta"/>
                    </h:panelGrid>
                    <h:outputLabel for="idRol" styleClass="itemResaltado1" value="(*) Dependencia:"/>
                    <h:panelGrid columns="2">
                        <p:selectOneMenu disabled="#{ReporteController.disabled}" id="idRol" value="#{ReporteController.tmpIdRol}" required="true" requiredMessage="#{bundle.Requerido}" >
                            <f:selectItems value="#{RolController.rolSet}"/>
                        </p:selectOneMenu>
                        <p:message for="idRol"/>
                    </h:panelGrid> 
                    <h:outputLabel for="idEstadoTramitacion" styleClass="itemResaltado1" value="(*) Estado:"/>
                    <h:panelGrid columns="2">
                        <h:selectOneRadio id="idEstadoTramitacion" value="#{ReporteController.tmpEstadoTramitacion}" title="Seleccione una opción" required="true" requiredMessage="#{bundle.Requerido}"  >
                            <f:selectItems value="#{EstadoTramitacionController.estadoTramitacionSet}"/>
                        </h:selectOneRadio>
                        <p:message for="idEstadoTramitacion"/>
                    </h:panelGrid>
                    <p:commandButton id="cmdBuscar" type="submit" value="Buscar"  ajax="true" image="search" action="#{ReporteController.buscarDocumento()}" update="formMain" />
                </h:panelGrid>
            </p:panel>
            <p:dataTable id="dataTable" var="item" value="#{ReporteController.model}" scrollWidth="900" scrollRows="50"  scrollHeight="400" scrollable="true" liveScroll="true" resizableColumns="true" emptyMessage="#{bundle.SinRegistrosMensaje}">
                <p:column headerText="Acción" style="width:50px">
                    <f:facet name="header">  
                        <h:outputText value="Acción" />  
                    </f:facet>
                    <p:commandButton ajax="false" title="#{bundle.VerBoton}" image="ver" action="#{DocumentoController.verSetup(item.idDocumento.idDocumento,'/reportes/ListadoTramitacionOficina')}"/>
                </p:column>
                <p:column style="width:50px" >
                    <f:facet name="header">  
                        <h:outputText value="Derivado" />  
                    </f:facet>
                    <h:outputText value="#{item.fechaDerivacion}">
                        <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="dd/MM/yyyy" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Recibido" style="width:100px" >
                    <f:facet name="header">  
                        <h:outputText value="Recibido" />  
                    </f:facet>
                    <h:outputText value="#{item.fechaRegistro}">
                        <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="dd/MM/yyyy" />
                    </h:outputText>
                    <h:outputText value=" "/>
                    <h:outputText value="#{item.horaRegistro}">
                        <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Procesado" style="width:100px" >
                    <f:facet name="header">  
                        <h:outputText value="Procesado" />  
                    </f:facet>
                    <h:outputText value="#{item.fechaSalida}">
                        <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="dd/MM/yyyy" />
                    </h:outputText>
                    <h:outputText value=" "/>
                    <h:outputText value="#{item.horaSalida}">
                        <f:convertDateTime timeZone="#{UserManager.myTimeZone}" pattern="HH:mm" />
                    </h:outputText>
                </p:column>
                <p:column headerText="Despacho" style="width:100px" >
                    <f:facet name="header">  
                        <h:outputText value="Despacho" />  
                    </f:facet>
                    <h:outputText value="#{JSFutil.diferenciaTime(item.fechaRegistro, item.horaRegistro, item.fechaSalida, item.horaSalida)} "/>
                </p:column>
                <p:column headerText="Nro. Ent." style="width:50px" >
                    <f:facet name="header">  
                        <h:outputText value="Nro. Ent." />  
                    </f:facet>
                    <h:outputText value=" #{item.idDocumento.nroEntrada}"/>
                </p:column>
                <p:column headerText="Asunto" style="width:150px" >
                    <f:facet name="header">  
                        <h:outputText value="Asunto" />  
                    </f:facet>
                    <h:outputText value="#{item.idDocumento.asunto}"/>
                </p:column>
                <p:column headerText="Dependencia" style="width:100px" >  
                    <f:facet name="header">  
                        <h:outputText value="Dependencia" />  
                    </f:facet>
                    <h:outputText value="#{item.idRol.descripcionRol}"/>
                </p:column>  
                <p:column headerText="Nota" style="width:100px" > 
                    <f:facet name="header">  
                        <h:outputText value="Nota" />  
                    </f:facet>
                    <h:outputText value="#{item.notaBreve}"/>
                </p:column>  
                <p:column headerText="De" style="width:100px" > 
                    <f:facet name="header">  
                        <h:outputText value="De" />  
                    </f:facet>
                    <h:outputText value="#{item.remitidoPor}"/>
                </p:column>  
                <p:column headerText="Para" style="width:100px" > 
                    <f:facet name="header">  
                        <h:outputText value="Para" />  
                    </f:facet>
                    <h:outputText value="#{item.remitidoA}"/>
                </p:column>  
                <p:column headerText="Usuario" style="width:100px" > 
                    <f:facet name="header">  
                        <h:outputText value="Derivado" />  
                    </f:facet>
                    <h:outputText value="#{item.idUsuario}"/>
                </p:column>
                <p:column headerText="Adjunto" style="width:50px"> 
                    <f:facet name="header">  
                        <h:outputText value="Adjunto" />  
                    </f:facet>
                    <p:commandButton title="Descargar" image="download" ajax="false">
                        <p:fileDownload value="#{TramitacionController.download(item.idTramitacion)}" />  
                    </p:commandButton>
                </p:column> 
                <f:facet name="footer">  
                    Exportar a
                    <h:commandLink >  
                        <p:graphicImage alt="Excel" height="30" width="30" value="/iconos/excel.png" />  
                    <p:dataExporter type="xls" target="dataTable" fileName="listado" />  
                </h:commandLink>
                </f:facet>  
            </p:dataTable>
        </h:form>
    </ui:define>

</ui:composition>
